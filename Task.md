# Высоконагруженные системы

## Разработка и развертывание высоконагруженного сервиса с ИИ-оптимизацией на Go в Kubernetes

---

## Задание

Разработайте сервис на языке Go для обработки потоковых данных (например, симуляцию метрик от IoT-устройств или простых API-запросов), используя open source инструменты (Redis для кэширования, Prometheus для мониторинга).

Сервис должен включать простую аналитику нагрузки на основе статистических методов (без полноценных ИИ-моделей: используйте rolling average для сглаживания или z-score для аномалий на чистом Go).

Разверните сервис локально в Minikube или Kind; для студентов с доступом к облаку — опционально в Yandex.Cloud (Managed Kubernetes Service) или VK Cloud, с базовым масштабированием (HPA на CPU).

Для тестирования используйте бесплатные онлайн-лаборатории вроде Killercoda, если нет локальной машины.

Yandex.Cloud предоставляют бесплатные пробные аккаунты:  
https://yandex.cloud/ru

Сервис на Go должен обрабатывать не менее **1000 RPS** в тесте (используйте инструменты вроде Apache Bench или Locust для нагрузочного тестирования).

### Аналитика

Реализуйте на Go (goroutines для вычислений):

- сглаживание нагрузки (rolling average с окном 50 событий)
- детекцию аномалий по отклонению (threshold > 2σ)

---

## Требования к отчетности

Для каждого шага предоставьте доказательства:

- скриншоты вывода команд
- YAML-манифесты Kubernetes
- исходный код (минимум 200–300 строк на Go)
- логи мониторинга
- результаты нагрузочного теста
- отчет (минимум 3–5 страниц с анализом, таблицами и предложениями по применению)

Если используете онлайн-лаборатории (например, Killercoda), опишите шаги установки и эквивалентные локальные аналогии.

---

## Сложность задания

Проект требует базового понимания:

- Go (goroutines, channels)
- Kubernetes (Deployment, ConfigMaps)
- простого анализа трендов

Ожидаемое время выполнения:

- **Новичок:** 3 недели (60–90 часов)
- **Отличник:** 3 дня (24–30 часов)

Включает отладку, тестирование (точность > 70% на синтетических данных) и отчет.

---

## План выполнения проекта

### 1. Подготовка инфраструктуры и разработка сервиса на Go

- Установите Go 1.22+, Docker, Minikube/Kind  
  или используйте онлайн-лабораторию (Killercoda)

- Реализуйте core-сервис:
  - HTTP-эндпоинты для приема метрик
  - формат JSON: `timestamp`, `CPU`, `RPS`
  - кэширование в Redis (без Kafka)

- Интегрируйте аналитику:
  - rolling average (окно 50 событий)
  - z-score (threshold = 2, sliding window 50)
  - goroutines для вычислений
  - channels для передачи метрик

- Локальное тестирование:
  - симуляция 500 RPS (Locust)
  - точность прогнозов > 70%
  - false positive < 10%

Пример команд:

```bash
go mod init simple-service
docker build -t go-service .
minikube start --cpus=2 --memory=4g
```

## 2. Контейнеризация и развертывание в Kubernetes

### Контейнеризация

- Соберите Docker-образы (размер менее **300 MB**)
- Загрузите образы в:
  - локальный реестр **Minikube**
  - или **Docker Hub**

### Кластер Kubernetes

Варианты развертывания:

- локально: **Minikube**
- онлайн: **Killercoda**
- опционально: **Yandex.Cloud** (Managed Kubernetes, 2 ноды)

### Ingress

Настройте **NGINX Ingress** для эндпоинтов:

- `/metrics`
- `/analyze`

### Развертывание сервисов

- Go-сервис:
  - Deployment с **2 репликами**
- Redis:
  - установка через Helm (`bitnami/redis`)

### HPA (Horizontal Pod Autoscaler)

- метрика: **CPU**
- порог: `> 70%`
- `minReplicas = 2`
- `maxReplicas = 5`

### Экспорт метрик

Экспорт из Go-сервиса с использованием `prometheus/client_golang`:

- RPS
- количество аномалий

---

## 3. Мониторинг и оптимизация

### Мониторинг

- Установка **Prometheus + Grafana** через Helm
- Экспорт метрик из Go:
  - RPS
  - latency
  - anomaly_rate

### Дашборды Grafana

- RPS
- latency
- anomaly_rate

### Alertmanager

- алерт, если количество аномалий превышает **5 в минуту**

### Нагрузочное тестирование

- нагрузка: **500 RPS**
- длительность: **5 минут**
- ожидаемое масштабирование: до **4 реплик**
- latency: **< 50 мс**

### Оптимизация

- профилирование Go-приложения:
  - `pprof` (базовый уровень)
- тюнинг Redis:
  - настройка eviction policy

---

## Презентация проекта

### Цель презентации

Продемонстрировать:

- разработку сервиса на Go с аналитикой
- развертывание в Kubernetes
- настройку масштабирования
- стабильность (**99% uptime**)
- оптимизацию (**latency −20%** за счет кэша)

---

## Структура презентации

### 1. Введение

- цель проекта
- стек технологий:
  - Go
  - Redis
  - Kubernetes
  - Prometheus / Grafana
- среда выполнения:
  - Minikube
  - Killercoda
  - облако

### 2. Архитектура решения

- диаграмма:
  - Go-service → Redis
  - K8s pods, HPA, Ingress
- поток данных
- сниппет Go-кода

### 3. Развёртывание

- команды:
  - `minikube start`
  - Killercoda setup
  - `yc k8s cluster create`
- YAML-примеры
- скриншоты:
  - `kubectl get pods`
  - dashboard

### 4. Мониторинг и тестирование

- Prometheus scrape configs
- Grafana queries
- скриншоты дашбордов
- результаты теста: **1000 RPS**

### 5. Заключение

- основные достижения
- проблемы и способы их решения
- выводы и перспективы

---

## Структура отчета (PDF, 5–10 страниц)

- титульный лист
- введение
- архитектура решения
- развертывание
- заключение
- ссылки
- приложения:
  - полный код (Git-репозиторий)
  - YAML
  - скриншоты (10+)
  - логи тестов

---

## Дополнительные материалы

- код: GitHub / GitLab
- видео или скриншоты демонстрации
- презентация:
  - PowerPoint
  - Google Slides
  - PDF (8–15 слайдов)

---

## Формат сдачи

- отчет в формате `.docx` или `.pdf`
- обязательно включить:
  - скриншоты
  - выводы команд
  - описания ошибок
  - анализ тенденций

---

## Критерии оценивания

Максимальный балл: **50**  
Все критерии обязательны.

### Критерий 1. Go и аналитика

| Вариант | Баллы | Пояснение |
|--------|-------|----------|
| Выполнено верно | 7 | 200–300 строк Go, точность > 70%, 1000 RPS |
| Требуется доработка | 3 | 100+ строк, частично работает |
| Неверно | 0 | Не работает |

### Критерий 2. Kubernetes

| Вариант | Баллы |
|--------|-------|
| Выполнено верно | 21 |
| Требуется доработка | 11 |
| Неверно | 0 |

### Критерий 3. Мониторинг и нагрузка

| Вариант | Баллы |
|--------|-------|
| Выполнено верно | 22 |
| Требуется доработка | 11 |
| Неверно | 0 |
